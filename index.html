<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–î—Ä–∞–≥—ñ | –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–æ –ù–ú–¢</title>
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700;800&display=swap" rel="stylesheet">
  <!-- Google Analytics (GA4) -->
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-8FD9ZT8NKD"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-8FD9ZT8NKD');
  </script>
  <!-- Styles -->
  <style>
    :root {
      --primary: #a755e9;
      --secondary: #ff914d;
    }

    /* Use border-box sizing globally so padding does not increase the element width
       This prevents horizontal overflow on mobile devices and keeps content centred */
    *, *::before, *::after {
      box-sizing: border-box;
    }
    body, html {
      margin: 0;
      padding: 0;
      font-family: 'Montserrat', sans-serif;
      height: 100vh;
      overflow-x: hidden;
      color: #fff;
    }
    body {
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      background-attachment: fixed;
    }
    /* Each step fills the viewport and centres its content vertically */
    section {
      /* Hide all sections by default */
      display: none;
      padding: 2rem;
      min-height: 100vh;
      /* allow flex layout when shown */
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }
    section.current {
      /* Show the current section */
      display: flex;
    }
    h1, h2, h3, h4 {
      margin-top: 0;
    }
    p {
      line-height: 1.5;
      margin-top: 0.5rem;
    }
    .btn {
      background: var(--secondary);
      border: none;
      color: #fff;
      padding: 0.75rem 1.5rem;
      font-size: 1rem;
      border-radius: 999px;
      cursor: pointer;
      transition: transform 0.15s ease;
      margin: 0.5rem;
      display: inline-block;
    }
    .btn:hover {
      transform: scale(1.05);
    }
    .container {
      max-width: 800px;
      width: 100%;
      margin: auto;
      text-align: center;
    }
    .chip-group {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      margin: 1rem 0;
    }
    .chip {
      margin: 0.25rem;
      padding: 0.6rem 1rem;
      border: 2px solid rgba(255,255,255,0.7);
      border-radius: 999px;
      color: #fff;
      cursor: pointer;
      transition: all 0.2s ease;
      position: relative;
      font-size: 0.9rem;
      text-align: center;
    }
    .chip:hover {
      transform: scale(1.05);
    }
    .chip.selected {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      border-color: #fff;
      color: #fff;
      transform: scale(1.1);
      box-shadow: 0 0 12px 4px rgba(255,145,77,0.8);
      animation: none;
    }
    .chip.disabled {
      background: rgba(255,255,255,0.2);
      border-color: rgba(255,255,255,0.3);
      color: rgba(255,255,255,0.6);
    }
    /* Card container to constrain images and give rounded corners */
    .card {
      /* Subtle translucent background on the hero card */
      background: rgba(255,255,255,0.15);
      /* Narrower padding to reduce the outer frame */
      padding: 0.5rem;
      /* Softer large radius for rounded corners */
      border-radius: 48px;
      margin: 1rem auto;
      /* Reduce overall width for a more elegant look */
      max-width: 500px;
    }
    .card img {
      /* Occupy the full width of the card and remove white edges */
      width: 100%;
      height: auto;
      display: block;
      margin-left: auto;
      margin-right: auto;
      /* Rounded corners to match the card */
      border-radius: 40px;
    }

    /* Ensure links in helper text are clearly clickable */
    .small-text a {
      color: #fff;
      text-decoration: underline;
      pointer-events: auto;
    }

    /* Price styling for final call to action */
    .old-price {
      text-decoration: line-through;
      opacity: 0.7;
      font-size: 1rem;
      margin-right: 0.5rem;
    }
    .new-price {
      /* High contrast background and white text for better readability */
      background: rgba(255,145,77,0.8);
      color: #fff;
      padding: 0.2rem 0.6rem;
      border-radius: 8px;
      font-weight: 800;
      font-size: 1.6rem;
      /* subtle glow to draw attention */
      text-shadow: 0 0 6px rgba(255,145,77,0.7);
    }
    .promo-badge {
      background: rgba(255,255,255,0.3);
      color: #fff;
      padding: 0.2rem 0.6rem;
      border-radius: 12px;
      margin-left: 0.5rem;
      font-size: 0.9rem;
    }

    /* Day/time layout for schedule selection */
    .day-grid {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
    }
    .day-wrapper {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 0.25rem;
    }
    .day-wrapper .chip {
      margin: 0.25rem;
    }
    .day-wrapper .time-pill {
      margin-top: 0.25rem;
    }

    /* Larger app store buttons for emphasis */
    .store-btn {
      display: inline-block;
      margin: 0.5rem 1rem;
    }
    .store-btn img {
      height: 56px;
      width: auto;
      display: block;
    }

    /* Grouping for the final call-to-action buttons */
    .store-buttons {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 1rem;
      margin: 1rem 0;
      flex-wrap: wrap;
    }
    .progress-container {
      width: 100%;
      background: rgba(255,255,255,0.4);
      border-radius: 4px;
      overflow: hidden;
      margin: 1rem 0;
      height: 14px;
    }
    .progress-bar {
      height: 100%;
      background: var(--secondary);
      width: 0%;
      transition: width 0.1s linear;
    }
    .small-text {
      font-size: 0.8rem;
      margin-top: 0.5rem;
    }
    .week-preview {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 0.5rem;
      margin-top: 1rem;
    }
    .week-preview .day {
      background: rgba(255,255,255,0.15);
      border-radius: 8px;
      padding: 0.5rem;
      min-height: 60px;
    }
    .week-preview .day h4 {
      margin: 0 0 0.25rem 0;
      font-size: 0.9rem;
      text-align: center;
    }
    .week-preview .day ul {
      list-style: none;
      padding: 0;
      margin: 0;
      font-size: 0.8rem;
    }
    /* Time pill used for interactive time selection */
    .time-pill {
      margin: 0.25rem;
      padding: 0.5rem 0.8rem;
      border-radius: 999px;
      background: rgba(255,255,255,0.2);
      border: 2px solid rgba(255,255,255,0.7);
      cursor: pointer;
      font-size: 0.85rem;
      color: #fff;
      transition: all 0.2s ease;
    }
    .time-pill:hover {
      transform: scale(1.05);
    }

    /* Subject block spacing for schedule step */
    .subject-block {
      margin-bottom: 1.5rem;
    }
    .subject-block h3 {
      text-align: center;
      margin-top: 0;
      margin-bottom: 0.5rem;
    }
    /* Ensure day chips and time pills stack vertically within the subject block */
    .subject-block > .chip-group {
      margin-bottom: 0.5rem;
    }
    .subject-block {
      margin-bottom: 2rem;
      text-align: center;
    }
    .subject-block h3 {
      margin-bottom: 0.6rem;
      color: #fff;
      text-align: center;
    }
    /* Increase space between the subject title and its first goal option */
    .subject-block label:first-of-type {
      margin-top: 0.4rem;
    }
    .img-container {
      text-align: center;
      margin: 1rem 0;
    }
    .img-container img {
      width: 80%;
      max-width: 600px;
      height: auto;
      display: block;
      margin: 0 auto;
      border-radius: 16px;
    }
    .caution {
      background: rgba(255,255,255,0.2);
      padding: 0.75rem;
      border-radius: 8px;
      margin-top: 1rem;
      font-size: 0.9rem;
      text-align: left;
    }
    /* App settings display */
    #app-settings {
      margin-top: 1rem;
      text-align: left;
    }
    .subject-setting {
      margin-bottom: 1rem;
    }
    .subject-setting h4 {
      margin: 0 0 0.2rem 0;
      font-size: 1rem;
    }
    .subject-setting ul {
      list-style: none;
      padding: 0;
      margin: 0;
      font-size: 0.9rem;
    }

    /* Store download buttons with icons */
    .store-btn {
      display: inline-block;
      margin: 0.5rem;
    }
    .store-btn img {
      height: 48px;
      width: auto;
      display: block;
    }
    /* Responsive adjustments for mobile devices */
    @media (max-width: 600px) {
      /* Use two columns for the week preview to fit narrow screens */
      .week-preview {
        grid-template-columns: repeat(2, 1fr);
      }
      /* Ensure containers remain centred and padded symmetrically */
      .container {
        padding: 1rem;
        margin-left: auto;
        margin-right: auto;
      }
      /* Add horizontal padding to each section so content isn't pushed to the right */
      section {
        padding-left: 1rem;
        padding-right: 1rem;
      }
      /* Make buttons full width and stack vertically */
      .btn {
        width: 100%;
        margin: 0.4rem 0;
      }
      /* Expand images to fit the container without white lines on the sides */
      .img-container img {
        width: 100%;
        max-width: none;
      }
    }
  </style>
</head>
<body>
  <!-- Step 1: Intro -->
  <section id="step-1" class="current">
    <div class="container">
      <h1>–ì–æ—Ç—É–π—Å—è –¥–æ –ù–ú–¢ –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —Ç–∞ –≤ –∫–∞–π—Ñ –∑ –î—Ä–∞–≥—ñ! üöÄ</h1>
      <p>–ü—Ä–∏–≤—ñ—Ç! –ì–æ—Ç–æ–≤–∏–π(–∞) –∑—Ä–æ–±–∏—Ç–∏ —Å–≤—ñ–π –ø–µ—Ä—à–∏–π —à–≤–∏–¥–∫–∏–π –∫—Ä–æ–∫ –¥–æ —É—Å–ø—ñ—à–Ω–æ–≥–æ –ù–ú–¢?</p>
      <p><strong>–ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–µ –ø–æ–≤–Ω–µ –ø–ª–∞–Ω—É–≤–∞–Ω–Ω—è –ø—ñ–¥–≥–æ—Ç–æ–≤–∫–∏ –∑—ñ –≤—Å—ñ—Ö –ø—Ä–µ–¥–º–µ—Ç—ñ–≤</strong> ‚Äì –∑–∞–π–º–µ <strong>4 —Ö–≤–∏–ª–∏–Ω–∏</strong>!</p>
      <div class="card">
        <img src="https://i.postimg.cc/SsRcBKCp/image.png" alt="–ö—Ä–µ–∞—Ç–∏–≤">
      </div>
      <button class="btn" onclick="nextStep()">–ü–æ—á–∞—Ç–∏</button>
    </div>
  </section>

  <!-- Step 2: Exam year selection -->
  <section id="step-2">
    <div class="container">
      <h2>–ö–æ–ª–∏ —Ç–∏ –ø–ª–∞–Ω—É—î—à —Å–∫–ª–∞–¥–∞—Ç–∏ –ù–ú–¢?</h2>
      <div class="chip-group">
        <div class="chip" data-value="2026" onclick="selectExamYear('2026')">2026</div>
        <div class="chip" data-value="2027" onclick="selectExamYear('2027')">2027</div>
      </div>
      <div>
        <button class="btn" onclick="goToSubjects()">–î–∞–ª—ñ</button>
        <button class="btn" onclick="prevStep()">–ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—å</button>
      </div>
    </div>
  </section>

  <!-- Step 3: Subject selection -->
  <section id="step-3">
    <div class="container">
      <h2>–ó —è–∫–∏—Ö –ø—Ä–µ–¥–º–µ—Ç—ñ–≤ —Ç–∏ –ø–ª–∞–Ω—É—î—à —Å–∫–ª–∞–¥–∞—Ç–∏ –ù–ú–¢?</h2>
      <div class="chip-group" id="subject-chips">
        <div class="chip" data-subject="–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞ –º–æ–≤–∞">–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞ –º–æ–≤–∞</div>
        <div class="chip" data-subject="–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞">–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞</div>
        <div class="chip" data-subject="–Ü—Å—Ç–æ—Ä—ñ—è –£–∫—Ä–∞—ó–Ω–∏">–Ü—Å—Ç–æ—Ä—ñ—è –£–∫—Ä–∞—ó–Ω–∏</div>
        <div class="chip" data-subject="English">English</div>
        <div class="chip" data-subject="–õ—ñ—Ç–µ—Ä–∞—Ç—É—Ä–∞">–õ—ñ—Ç–µ—Ä–∞—Ç—É—Ä–∞</div>
        <div class="chip" data-subject="–ì–µ–æ–≥—Ä–∞—Ñ—ñ—è">–ì–µ–æ–≥—Ä–∞—Ñ—ñ—è</div>
        <div class="chip disabled" data-subject="–•—ñ–º—ñ—è">–•—ñ–º—ñ—è<br><small>(–∑ 01.10.)</small></div>
        <div class="chip disabled" data-subject="–ë—ñ–æ–ª–æ–≥—ñ—è">–ë—ñ–æ–ª–æ–≥—ñ—è<br><small>(–∑ 20.10.)</small></div>
        <div class="chip disabled" data-subject="–§—ñ–∑–∏–∫–∞">–§—ñ–∑–∏–∫–∞<br><small>(–∑ 20.10.)</small></div>
        <div class="chip disabled" data-subject="–ù—ñ–º–µ—Ü—å–∫–∞">–ù—ñ–º–µ—Ü—å–∫–∞<br><small>(–∑ 01.10.)</small></div>
      </div>
      <p class="small-text">–ù–µ –≤–∏–∑–Ω–∞—á–∏–≤—Å—è(–ª–∞—Å—å) –∑ –≤–∏–±—ñ—Ä–∫–æ–≤–∏–º (4-–º) –ø—Ä–µ–¥–º–µ—Ç–æ–º? –°–∫–æ—Ä–∏—Å—Ç–∞–π—Å—è –Ω–∞—à–∏–º –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∏–º —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–º –∑–∞ <a href="https://t.me/dragiapp_bot" target="_blank">–ø–æ—Å–∏–ª–∞–Ω–Ω—è–º</a>.</p>
      <div>
        <button class="btn" onclick="goToAd()">–î–∞–ª—ñ</button>
        <button class="btn" onclick="prevStep()">–ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—å</button>
      </div>
    </div>
  </section>

  <!-- Step 4: Ad / Features -->
  <section id="step-4">
    <div class="container">
      <h2>–ó—Ä–æ–∑—É–º—ñ–≤! –ü—Ä–∏–∫–æ–ª—å–Ω—ñ –ø—Ä–µ–¥–º–µ—Ç–∏!</h2>
      <p>–ö–ª–∞—Å–Ω–æ, —â–æ –≤ –î—Ä–∞–≥—ñ —Ç–∏ –º–∞—î—à –¥–æ—Å—Ç—É–ø –¥–æ –Ω–∏—Ö –≤—Å—ñ—Ö –≤ –æ–¥–Ω–æ–º—É –º—ñ—Å—Ü—ñüëá</p>
      <div class="img-container">
        <img src="https://i.postimg.cc/fRYKdJM8/image.png" alt="–ü–µ—Ä–µ–≤–∞–≥–∏">
      </div>
      <div>
        <button class="btn" onclick="goToGoals()">–ô–¥–µ–º–æ –¥–∞–ª—ñ</button>
        <button class="btn" onclick="prevStep()">–ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—å</button>
      </div>
    </div>
  </section>

  <!-- Step 5: Goals per subject -->
  <section id="step-5">
    <div class="container">
      <h2>–î—É–∂–µ –≤–∞–∂–ª–∏–≤–æ –ø–æ—Å—Ç–∞–≤–∏—Ç–∏ —Å–æ–±—ñ –ø—Ä–∞–≤–∏–ª—å–Ω—ñ —Ü—ñ–ª—ñ ü§ì</h2>
      <p>–Ø–∫—ñ —Ç–≤–æ—ó –æ—Ä—ñ—î–Ω—Ç–æ–≤–Ω—ñ –±–∞–∂–∞–Ω—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –∑ –∫–æ–∂–Ω–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç—É –≤–∑—è—Ç–∏ –∑–∞ –æ—Å–Ω–æ–≤—É?</p>
      <div id="goals-container"></div>
      <div>
        <button class="btn" onclick="goToLoading1()">–î–∞–ª—ñ</button>
        <button class="btn" onclick="prevStep()">–ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—å</button>
      </div>
    </div>
  </section>

  <!-- Step 6: Loading screen 1 -->
  <section id="step-6">
    <div class="container">
      <h2>–û—Å—å, —è–∫ –î—Ä–∞–≥—ñ —ñ–Ω—Ç–µ–≥—Ä–æ–≤—É—é—Ç—å –≤ —Å–≤–æ—é —Ä—É—Ç–∏–Ω—Éüëá</h2>
      <div class="progress-container">
        <div id="progress-1" class="progress-bar"></div>
      </div>
      <p id="loading-text-1">–ê–Ω–∞–ª—ñ–∑—É—é —Ç–≤–æ—ó –∞–º–±—ñ—Ü—ñ—ó —ñ —Å—Ç–≤–æ—Ä—é—é –¥–ª—è —Ç–µ–±–µ —ñ–¥–µ–∞–ª—å–Ω–∏–π –≥—Ä–∞—Ñ—ñ–∫‚Ä¶üß†</p>
      <div class="img-container">
        <img src="https://i.postimg.cc/ZqGvxLj3/image.png" alt="Loading">
      </div>
    </div>
  </section>

  <!-- Step 7: Days & time selection -->
  <section id="step-7">
    <div class="container">
      <h2>–¢–µ–ø–µ—Ä –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç—É –≤–∏–±–µ—Ä–∏ –¥–Ω—ñ —Ç–∏–∂–Ω—è —Ç–∞ —á–∞—Å, –∫–æ–ª–∏ —Ç–∏ —Ö–æ—á–µ—à –∑–∞–π–º–∞—Ç–∏—Å—å</h2>
      <p>–ú–∏ —Ä–µ–∫–æ–º–µ–Ω–¥—É—î–º–æ –ø–æ 3-4 –¥–Ω—ñ –Ω–∞ —Ç–∏–∂–¥–µ–Ω—å, —Ç–æ–¥—ñ —Ç–æ–±—ñ –ø–æ—Ç—Ä—ñ–±–Ω–æ –±—É–¥–µ –∑–∞–π–º–∞—Ç–∏—Å—å 20-30 —Ö–≤–∏–ª–∏–Ω –Ω–∞ –¥–µ–Ω—å üòá</p>
      <p class="small-text"><em>*—â–æ–± –∑–º—ñ–Ω–∏—Ç–∏ —á–∞—Å –ø–æ—á–∞—Ç–∫—É –Ω–∞–≤—á–∞–Ω–Ω—è, –ø—Ä–æ—Å—Ç–æ –∫–ª–∞—Ü–Ω–∏ –Ω–∞ –ø–æ–ª–µ —á–∞—Å—Éü§ì</em></p>
      <div id="schedule-container"></div>
      <div>
        <!-- On mobile and desktop, show the primary action (next) above the back button -->
        <button class="btn" onclick="goToLoading2()">–î–∞–ª—ñ</button>
        <button class="btn" onclick="prevStep()">–ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—å</button>
      </div>
    </div>
  </section>

  <!-- Step 8: Loading screen 2 -->
  <section id="step-8">
    <div class="container">
      <h2>–û—Å—å —è–∫ –±—É–¥–µ –≤–∏–≥–ª—è–¥–∞—Ç–∏ –ø—Ä–æ—Ü–µ—Å —Ç–≤–æ–≥–æ –Ω–∞–≤—á–∞–Ω–Ω—è –≤ –î—Ä–∞–≥—ñ. –¶–µ –±—É–¥–µ —è—Å–∫—Ä–∞–≤–æ!</h2>
      <div class="progress-container">
        <div id="progress-2" class="progress-bar"></div>
      </div>
      <p id="loading-text-2">–ê–Ω–∞–ª—ñ–∑—É—é —Ç–≤–æ—ó –ø–æ–±–∞–∂–∞–Ω–Ω—è —ñ —Å—Ç–≤–æ—Ä—é—é –¥–ª—è —Ç–µ–±–µ —ñ–¥–µ–∞–ª—å–Ω–∏–π –≥—Ä–∞—Ñ—ñ–∫‚Ä¶üß†</p>
      <div class="img-container">
        <img src="https://i.postimg.cc/9FP3mXvj/image.png" alt="Process">
      </div>
    </div>
  </section>

  <!-- Step 9: Instructions ready -->
  <section id="step-9">
    <div class="container">
      <h2>–ì–æ—Ç–æ–≤–æ!</h2>
      <p>–ù–∏–∂—á–µ —Ç–∏ –º–æ–∂–µ—à –∑–Ω–∞–π—Ç–∏ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –¥–ª—è –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É. –ó–∞–≤–¥—è–∫–∏ –Ω–∏–º, —Ç–∏ –±—É–¥–µ—à –±–∞—á–∏—Ç–∏ –≤ —Å–∞–º–æ–º—É –∑–∞—Å—Ç–æ—Å—É–Ω–∫—É, —Å–∫—ñ–ª—å–∫–∏ —Ç–æ–±—ñ —É—Ä–æ–∫—ñ–≤ –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø—Ä–æ–π—Ç–∏ –≤ –ø–µ–≤–Ω–∏–π –∑–∞–ø–ª–∞–Ω–æ–≤–∞–Ω–∏–π –¥–µ–Ω—å.</p>
      <p>–¢–∏ –∑–∞–≤–∂–¥–∏ –º–æ–∂–µ—à —Å–∫–æ—Ä–∏–≥—É–≤–∞—Ç–∏, –∞–±–æ –ø–µ—Ä–µ–ø–ª–∞–Ω—É–≤–∞—Ç–∏ –≥—Ä–∞—Ñ—ñ–∫ –Ω–∞–≤—á–∞–Ω–Ω—è, —è–∫—â–æ —É —Ç–≤–æ–≥–æ –¥—Ä—É–≥–∞, –∞–±–æ –ø–æ–¥—Ä—É–≥–∏ –î–µ–Ω—å –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è üòá</p>
      <p>–ù—É —ñ –∑–≤—ñ—Å–Ω–æ, —è–∫—â–æ –≤—Å–µ –±—É–¥–µ—à —Å–∏—Å—Ç–µ–º–∞—Ç–∏—á–Ω–æ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏, –∫—Ä—ñ–º –î—Ä–∞–≥—ñ –¢–æ–∫–µ–Ω—ñ–≤ ‚Äì –æ—Ç—Ä–∏–º–∞—î—à —â–∞—Å–ª–∏–≤–æ–≥–æ –î—Ä–∞–≥—ñ, —è–∫–∏–π —Ç–µ–±–µ –ø–æ—Ö–≤–∞–ª–∏—Ç—å!</p>
      <p><strong>–ó–∞—Å–∫—Ä—ñ–Ω—å —ó—Ö üì∏üòá</strong></p>
      <!-- App settings will be injected here -->
      <div id="app-settings"></div>
      <div>
        <!-- Show "–ü–µ—Ä–µ–π—Ç–∏ –¥–æ –≥–æ—Ç–æ–≤–æ–≥–æ –≥—Ä–∞—Ñ—ñ–∫—É!" before the back button to emphasise the next step -->
        <button class="btn" onclick="goToLoading3()">–ü–µ—Ä–µ–π—Ç–∏ –¥–æ –≥–æ—Ç–æ–≤–æ–≥–æ –≥—Ä–∞—Ñ—ñ–∫—É!</button>
        <button class="btn" onclick="prevStep()">–ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—å</button>
      </div>
    </div>
  </section>

  <!-- Step 10: Loading screen 3 -->
  <section id="step-10">
    <div class="container">
      <h2>–ê –∑–Ω–∞—î—à, —â–æ –ø—Ä–æ –î—Ä–∞–≥—ñ –≥–æ–≤–æ—Ä—è—Ç—å –≤—á–∏—Ç–µ–ª—ñ?</h2>
      <p>–í–æ–Ω–∏ –π–æ–≥–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É—é—Ç—å!</p>
      <div class="progress-container">
        <div id="progress-3" class="progress-bar"></div>
      </div>
      <p id="loading-text-3">–§—ñ–Ω–∞–ª—å–Ω—ñ –ø—Ä–∏–≥–æ—Ç—É–≤–∞–Ω–Ω—è, –≥–æ—Ç—É—é —Ç–≤—ñ–π –≥—Ä–∞—Ñ—ñ–∫‚Ä¶üß†</p>
      <div class="img-container">
        <img src="https://i.postimg.cc/MZFnTSfd/n-kj-jn.png" alt="Teachers">
      </div>
    </div>
  </section>

  <!-- Step 11: Calendar preview & download -->
  <section id="step-11">
    <div class="container">
      <h2>–õ–æ–≤–∏ —Å–≤—ñ–π –æ—Å–æ–±–∏—Å—Ç–∏–π –ø–æ–≤–Ω–∏–π –≥—Ä–∞—Ñ—ñ–∫ –ø—ñ–¥–≥–æ—Ç–æ–≤–∫–∏!</h2>
      <p>–ù–∏–∂–µ ‚Äî –ø—Ä–µ–≤‚Äô—é —Ç–≤–æ–≥–æ —Ç–∏–ø–æ–≤–æ–≥–æ —Ç–∏–∂–Ω—è:</p>
      <div class="week-preview" id="week-preview"></div>
      <div class="caution">
        <h3>–Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î?</h3>
        <p>–ü—ñ—Å–ª—è —Ç–æ–≥–æ, —è–∫ —Ç–∏ –∫–ª–∞—Ü–Ω–µ—à –∫–Ω–æ–ø–∫—É ¬´–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏¬ª, —É —Ç–≤–æ—î–º—É –∫–∞–ª–µ–Ω–¥–∞—Ä—ñ –∑ º—è–≤–ª—è—Ç—å—Å—è —Ä–æ–∑–ø–ª–∞–Ω–æ–≤–∞–Ω—ñ –∑–∞–Ω—è—Ç—Ç—è –≤ –î—Ä–∞–≥—ñ, —ñ —Ç–æ–±—ñ –±—É–¥—É—Ç—å –ø—Ä–∏—Ö–æ–¥–∏—Ç–∏ –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –∑–∞ 5 —Ö–≤–∏–ª–∏–Ω –¥–æ –ø–æ—á–∞—Ç–∫—É –∑–∞–Ω—è—Ç—Ç—è. –¶–µ–π –ø–ª–∞–Ω –¥–æ–∑–≤–æ–ª–∏—Ç—å —Ç–æ–±—ñ —Å–∏—Å—Ç–µ–º–∞—Ç–∏—á–Ω–æ —Ç–∞ –±–µ–∑ —Å—Ç—Ä–µ—Å—É –≥–æ—Ç—É–≤–∞—Ç–∏—Å—å –¥–æ –ù–ú–¢.</p>
        <p>–Ø–∫—â–æ —Ä–∞–ø—Ç–æ–º –∑–∞—Ö–æ—á–µ—à –ø–æ–≤–Ω—ñ—Å—Ç—é –∑–∞–Ω–æ–≤–æ –ø–µ—Ä–µ–ø–ª–∞–Ω—É–≤–∞—Ç–∏ –Ω–∞–≤—á–∞–Ω–Ω—è, —Å–ø–æ—á–∞—Ç–∫—É –≤–∏–¥–∞–ª–∏ –≤—Å—ñ –ø–æ–¥—ñ—ó, —è–∫—ñ —Å—Ç–≤–æ—Ä–∏–≤ –î—Ä–∞–≥—ñ, —É —Å–≤–æ—î–º—É –∫–∞–ª–µ–Ω–¥–∞—Ä—ñ —Ç–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂ –Ω–æ–≤–∏–π —Ñ–∞–π–ª. –Ø–∫—â–æ –≤–∏–Ω–∏–∫–Ω—É—Ç—å –ø—Ä–æ–±–ª–µ–º–∏ ‚Äî –∑–≤–µ—Ä—Ç–∞–π—Å—è –¥–æ –Ω–∞—à–æ—ó –ø—ñ–¥—Ç—Ä–∏–º–∫–∏: <a href="https://t.me/dragi_support" target="_blank" style="color:#fff;text-decoration:underline;">t.me/dragi_support</a>.</p>
      </div>
      <div>
        <button class="btn" onclick="downloadSchedule()">–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –≥—Ä–∞—Ñ—ñ–∫ —É —Å–≤—ñ–π –∫–∞–ª–µ–Ω–¥–∞—Ä</button>
        <button class="btn" onclick="goToStep12()">–î–∞–ª—ñ</button>
      </div>
      <div>
        <button class="btn" onclick="replanSchedule()">–ü–µ—Ä–µ–ø–ª–∞–Ω—É–≤–∞—Ç–∏</button>
      </div>
      <!-- Fallback container for Telegram downloads; hidden by default -->
      <div id="ics-copy-container" style="display:none;margin-top:1rem;text-align:left;">
        <p style="margin-bottom:0.5rem;font-weight:600;">–ö–æ–ø—ñ—é–≤–∞–Ω–Ω—è –≥—Ä–∞—Ñ—ñ–∫—É</p>
        <p style="margin-bottom:0.5rem;">–ù–∞–∂–∞–ª—å, —É –≤–Ω—É—Ç—Ä—ñ—à–Ω—å–æ–º—É –±—Ä–∞—É–∑–µ—Ä—ñ Telegram –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤ –æ–±–º–µ–∂–µ–Ω–µ. –¢–∏ –º–æ–∂–µ—à —Å–∫–æ–ø—ñ—é–≤–∞—Ç–∏ —Ç–µ–∫—Å—Ç –Ω–∏–∂—á–µ –π –∑–±–µ—Ä–µ–≥—Ç–∏ –π–æ–≥–æ —É —Ñ–∞–π–ª –∑ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è–º <code>.ics</code> –≤—Ä—É—á–Ω—É, –∞–±–æ –≤—ñ–¥–∫—Ä–∏—Ç–∏ —Å—Ç–æ—Ä—ñ–Ω–∫—É —É –∑–æ–≤–Ω—ñ—à–Ω—å–æ–º—É –±—Ä–∞—É–∑–µ—Ä—ñ.</p>
        <textarea id="ics-text" readonly style="width:100%;min-height:150px;font-family:monospace;font-size:0.8rem;padding:0.5rem;border-radius:8px;border:1px solid #ccc;"></textarea>
      </div>
    </div>
  </section>

  <!-- Step 12: Join Telegram -->
  <section id="step-12">
    <div class="container">
      <h2>–ù—É –æ—Å—å ‚Äì –±—É–∫–≤–∞–ª—å–Ω–æ –∑–∞ 4 —Ö–≤–∏–ª–∏–Ω–∏ –º–∏ –∑ —Ç–æ–±–æ—é —Å–ø–ª–∞–Ω—É–≤–∞–ª–∏ —Ç–≤–æ—é –ø—ñ–¥–≥–æ—Ç–æ–≤–∫—É –Ω–∞ —Ü—ñ–ª–∏–π —Ä—ñ–∫ üöÄ</h2>
      <p>–ö—Ä—É—Ç–æ, –ø—Ä–∞–≤–¥–∞? üòè</p>
      <p>–î–æ–ª—É—á–∞–π—Å—è –¥–æ –Ω–∞—à–æ–≥–æ –µ–ª—ñ—Ç–Ω–æ–≥–æ –∫–æ–º'—é–Ω—ñ—Ç—ñ –≤ –¢–µ–ª–µ–≥—Ä–∞–º—ñ –π –¥—ñ–∑–Ω–∞–≤–∞–π—Å—è –ø—Ä–æ –≤—Å—ñ –Ω–æ–≤–∏–Ω–∏ –Ω–∞–≤–∫–æ–ª–æ –ù–ú–¢ —Ç–∞ –î—Ä–∞–≥—ñ –ø–µ—Ä—à–∏–º(–æ—é).</p>
      <div>
        <a href="https://t.me/dragi_space" target="_blank" class="btn" id="telegram-btn" onclick="gtag('event','telegram_join',{event_category:'onboarding',event_label:'telegram_button',step_key:'telegram',step_index:12});">–ü—Ä–∏—î–¥–Ω–∞—Ç–∏—Å—è –¥–æ Telegram</a>
      </div>
      <div>
        <!-- Reorder buttons so the primary action appears above the back button -->
        <button class="btn" onclick="goToFinal()">–î–∞–ª—ñ</button>
        <button class="btn" onclick="prevStep()">–ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—å</button>
      </div>
    </div>
  </section>

  <!-- Step 13: Final call to action -->
  <section id="step-13">
    <div class="container">
      <h2>–ó–∞–≤–∞–Ω—Ç–∞–∂—É–π –∑–∞—Å—Ç–æ—Å—É–Ω–æ–∫ –î—Ä–∞–≥—ñ</h2>
      <p>–ì–æ—Ç—É–π—Å—è –¥–æ –ù–ú–¢ –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ, —Ü—ñ–∫–∞–≤–æ —Ç–∞ –≤ –∫–∞–π—Ñ –∑ –î—Ä–∞–≥—ñ!</p>
      <p><strong>–û—Å—Ç–∞–Ω–Ω—ñ–π –∫—Ä–æ–∫ ‚Äî –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –∑–∞—Å—Ç–æ—Å—É–Ω–æ–∫ –î—Ä–∞–≥—ñ —Ç–∞ –æ—Ñ–æ—Ä–º–∏—Ç–∏ –ø—ñ–¥–ø–∏—Å–∫—É –≤ —Ä–æ–∑–¥—ñ–ª—ñ ¬´–Ü–Ω—à–µ¬ª.</strong> –¢—ñ–ª—å–∫–∏ —Ç–∞–∫ —Ç–∏ –æ—Ç—Ä–∏–º–∞—î—à –ø–æ–≤–Ω–∏–π –¥–æ—Å—Ç—É–ø –¥–æ –≤—Å—ñ—Ö –∫—É—Ä—Å—ñ–≤, –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–≥–æ –≥—Ä–∞—Ñ—ñ–∫—É —Ç–∞ –º–æ—Ç–∏–≤–∞—Ü—ñ–π–Ω–∏—Ö –±–æ–Ω—É—Å—ñ–≤.</p>
      <p>–ù–∞–≤—á–∞–Ω–Ω—è –≤ –î—Ä–∞–≥—ñ —Ü—ñ–ª–∏–π –º—ñ—Å—è—Ü—å –∑—ñ –≤—Å—ñ—Ö –ø—Ä–µ–¥–º–µ—Ç—ñ–≤ –∫–æ—à—Ç—É—î —Ç–∞–∫ —Å–∞–º–æ, —è–∫ –Ω–∞–≤—á–∞–Ω–Ω—è –∑ –≤—á–∏—Ç–µ–ª–µ–º –∑ –æ–¥–Ω–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç—É –æ–¥–Ω—É –≥–æ–¥–∏–Ω—É!</p>
      <p>
        <span class="old-price">6250&nbsp;–≥—Ä–Ω</span>
        <span class="new-price">417&nbsp;–≥—Ä–Ω/–º—ñ—Å—è—Ü—å*</span>
        <span class="promo-badge">–ê–∫—Ü—ñ–π–Ω–∞ —Ü—ñ–Ω–∞!</span>
      </p>
      <!-- Call to action prompting free trial -->
      <p>–ó–∞–≤–∞–Ω—Ç–∞–∂—É–π —ñ —Å–ø—Ä–æ–±—É–π –≤–∂–µ –∑–∞—Ä–∞–∑ –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ! –¢–æ–±—ñ —Å–ø–æ–¥–æ–±–∞—î—Ç—å—Å—èüòáüëá</p>
      <!-- Store buttons placed immediately under the price for better emphasis -->
      <div class="store-buttons">
        <a href="https://apps.apple.com/ua/app/%D0%B4%D1%80%D0%B0%D0%B3%D1%96-%D0%BF%D1%96%D0%B4%D0%B3%D0%BE%D1%82%D0%BE%D0%B2%D0%BA%D0%B0-%D0%B4%D0%BE-%D0%BD%D0%BC%D1%82-%D0%B7%D0%BD%D0%BE/id6502047535?utm_source=onboarding&utm_medium=referral&utm_campaign=onboarding_flow" target="_blank" class="store-btn" id="apple-btn">
          <img src="https://i.postimg.cc/02fsb5hS/Download-on-the-App-Store-Badge-svg-2.png" alt="App Store" />
        </a>
        <a href="https://play.google.com/store/apps/details?id=ua.dragi.education&utm_source=onboarding&utm_medium=referral&utm_campaign=onboarding_flow" target="_blank" class="store-btn" id="google-btn">
          <img src="https://i.postimg.cc/6qzBJ9XC/Google-Play-Store-badge-EN-svg.png" alt="Google Play" />
        </a>
      </div>
      <p>–û—Ç—Ä–∏–º—É–π –ø–æ–≤–Ω–∏–π –¥–æ—Å—Ç—É–ø –¥–æ –î—Ä–∞–≥—ñ –∑–∞ –∞–∫—Ü—ñ–π–Ω–æ—é –≤–∞—Ä—Ç—ñ—Å—Ç—é —É —Ä–æ–∑–¥—ñ–ª—ñ ¬´–Ü–Ω—à–µ¬ª —Ç–∞ –∑–∞–æ—â–∞–¥–∂—É–π –ø–æ–Ω–∞–¥ 90% –≤–∞—Ä—Ç–æ—Å—Ç—ñ –∑–≤–∏—á–∞–π–Ω–∏—Ö —Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä—ñ–≤.</p>
      <div class="img-container">
        <img src="https://i.postimg.cc/W3mxyTLj/scnjhs.jpg" alt="–§—ñ–Ω–∞–ª—å–Ω–∏–π –∫—Ä–µ–∞—Ç–∏–≤">
      </div>
      <!-- Footnote explaining the star note -->
      <p class="small-text"><em>*–ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω—ñ –ø—ñ–¥–ø–∏—Å–∫–∏ –Ω–∞ 3 –º—ñ—Å—è—Ü—ñ</em></p>
      <!-- –ü–µ—Ä–µ–≤–∞–≥–∏ –≤–∏–ª—É—á–µ–Ω—ñ, —â–æ–± –∑—Ä–æ–±–∏—Ç–∏ –∞–∫—Ü–µ–Ω—Ç –Ω–∞ –≤–∏–≥–æ–¥—ñ —Ç–∞ —Ü—ñ–Ω—ñ -->
      <!-- –ö–Ω–æ–ø–∫—É –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –ø—Ä–∏–±—Ä–∞–Ω–æ, —â–æ–± —Ñ–æ–∫—É—Å –±—É–≤ –Ω–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ –¥–æ–¥–∞—Ç–∫—É -->
    </div>
  </section>

  <!-- Scripts -->
  <script>
    let currentStep = 1;
    const totalSteps = 13;
    let examYear = null;
    let selectedSubjects = [];
    const subjectHours = {
      '–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞ –º–æ–≤–∞': 68,
      '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞': 65,
      'English': 31,
      '–Ü—Å—Ç–æ—Ä—ñ—è –£–∫—Ä–∞—ó–Ω–∏': 63,
      '–õ—ñ—Ç–µ—Ä–∞—Ç—É—Ä–∞': 41,
      '–ì–µ–æ–≥—Ä–∞—Ñ—ñ—è': 90,
      '–•—ñ–º—ñ—è': 40,
      '–ë—ñ–æ–ª–æ–≥—ñ—è': 55,
      '–§—ñ–∑–∏–∫–∞': 31,
      '–ù—ñ–º–µ—Ü—å–∫–∞': 31
    };
    const subjectAvailableFrom = {
      '–•—ñ–º—ñ—è': '2025-10-01',
      '–ù—ñ–º–µ—Ü—å–∫–∞': '2025-10-01',
      '–ë—ñ–æ–ª–æ–≥—ñ—è': '2025-10-20',
      '–§—ñ–∑–∏–∫–∞': '2025-10-20'
    };
    let scheduleData = {};
    let subjectGoals = {};
    let calendar;
    // Array to hold calendar events for manual .ics generation
    let scheduleEvents = [];
    function showStep(n) {
      document.querySelectorAll('section').forEach(sec => sec.classList.remove('current'));
      const el = document.getElementById('step-' + n);
      if (el) el.classList.add('current');
      currentStep = n;
      window.scrollTo({ top: 0, behavior: 'smooth' });
      // render app settings when arriving at step 9
      if(n === 9) {
        renderAppSettings();
      }
    }
    function nextStep() {
      if (currentStep < totalSteps) showStep(currentStep + 1);
    }
    function prevStep() {
      if (currentStep > 1) {
        // Define steps that are considered loading screens which should be skipped when going back
        const loadingSteps = [6, 8, 10];
        let target = currentStep - 1;
        // Skip over any loading steps
        while (loadingSteps.includes(target) && target > 1) {
          target--;
        }
        showStep(target);
      }
    }
    function selectExamYear(year) {
      examYear = year;
      document.querySelectorAll('#step-2 .chip').forEach(ch => ch.classList.remove('selected'));
      const selected = document.querySelector(`#step-2 .chip[data-value="${year}"]`);
      if (selected) selected.classList.add('selected');
    }
    function goToSubjects() {
      if (!examYear) {
        alert('–û–±–µ—Ä—ñ—Ç—å —Ä—ñ–∫ —Å–∫–ª–∞–¥–∞–Ω–Ω—è –ù–ú–¢');
        return;
      }
      gtag('event','onboarding_step_view',{step_key:'subjects',step_index:3});
      showStep(3);
    }
    function attachSubjectSelection() {
      const chips = document.querySelectorAll('#subject-chips .chip');
      chips.forEach(chip => {
        chip.addEventListener('click', () => {
          if(chip.classList.contains('disabled')) return;
          const subj = chip.getAttribute('data-subject');
          chip.classList.toggle('selected');
          if (chip.classList.contains('selected')) {
            if (!selectedSubjects.includes(subj)) selectedSubjects.push(subj);
          } else {
            selectedSubjects = selectedSubjects.filter(s => s !== subj);
          }
        });
      });
    }
    function goToAd() {
      if (selectedSubjects.length === 0) {
        alert('–û–±–µ—Ä—ñ—Ç—å –ø—Ä–∏–Ω–∞–π–º–Ω—ñ –æ–¥–∏–Ω –ø—Ä–µ–¥–º–µ—Ç');
        return;
      }
      gtag('event','onboarding_step_view',{step_key:'ad',step_index:4});
      showStep(4);
    }
    function goToGoals() {
      gtag('event','onboarding_step_view',{step_key:'goals',step_index:5});
      const container = document.getElementById('goals-container');
      container.innerHTML = '';
      selectedSubjects.forEach(subj => {
        const block = document.createElement('div');
        block.className = 'subject-block';
        const title = document.createElement('h3');
        title.textContent = subj;
        block.appendChild(title);
        const chipRow = document.createElement('div');
        chipRow.className = 'chip-group';
        const options = ['115-150','150-170','170-180','180-190','190-200'];
        options.forEach(opt => {
          const chip = document.createElement('div');
          chip.className = 'chip';
          chip.textContent = opt;
          chip.addEventListener('click', () => {
            // Remove selected from siblings
            chipRow.querySelectorAll('.chip').forEach(c => c.classList.remove('selected'));
            chip.classList.add('selected');
            subjectGoals[subj] = opt;
          });
          chipRow.appendChild(chip);
        });
        block.appendChild(chipRow);
        container.appendChild(block);
      });
      showStep(5);
    }
    function goToLoading1() {
      // Ensure each selected subject has a goal assigned
      for (const subj of selectedSubjects) {
        if (!subjectGoals[subj]) {
          alert(`–û–±–µ—Ä—ñ—Ç—å –±–∞–∂–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è –ø—Ä–µ–¥–º–µ—Ç—É ${subj}`);
          return;
        }
      }
      gtag('event','onboarding_step_view',{step_key:'loading1',step_index:6});
      showStep(6);
      startLoading('progress-1', 7000, () => {
        buildScheduleForm();
        showStep(7);
      });
    }
    function startLoading(barId, duration, callback) {
      const bar = document.getElementById(barId);
      bar.style.width = '0%';
      let start = Date.now();
      const intId = setInterval(() => {
        let elapsed = Date.now() - start;
        let percent = Math.min(100, (elapsed / duration) * 100);
        bar.style.width = percent + '%';
        if (elapsed >= duration) {
          clearInterval(intId);
          callback();
        }
      }, 50);
    }
    function buildScheduleForm() {
      scheduleData = {};
      const container = document.getElementById('schedule-container');
      container.innerHTML = '';
      /*
       * Generate a list of time options in 30‚Äëminute increments. These options
       * allow choosing both afternoon and morning slots (for weekend mornings) starting
       * at 09:00 through 20:00. When cycling through times on a time pill, we
       * advance to the next entry in this list.
       */
      const timeOptions = [];
      // Build increments from 09:00 to 20:00 in 30 minute steps
      const startHour = 9;
      const endHour = 20;
      for (let h = startHour; h <= endHour; h++) {
        timeOptions.push(`${String(h).padStart(2,'0')}:00`);
        if (h !== endHour) {
          timeOptions.push(`${String(h).padStart(2,'0')}:30`);
        }
      }
      // Default start times for each subject (index based). These are used
      // when a user first selects a day; they can be adjusted later. Starts at 15:00.
      const defaultTimes = ['15:00','16:00','17:00','18:00','19:00','20:00'];
      selectedSubjects.forEach((subj, index) => {
        scheduleData[subj] = { days: [], times: {} };
        const block = document.createElement('div');
        block.className = 'subject-block';
        const h3 = document.createElement('h3');
        h3.textContent = subj;
        block.appendChild(h3);
        // Container for day/time wrappers. Each wrapper holds the day chip and its time pill below.
        const dayGrid = document.createElement('div');
        dayGrid.className = 'day-grid';
        const days = ['–ü–Ω','–í—Ç','–°—Ä','–ß—Ç','–ü—Ç','–°–±','–ù–¥'];
        days.forEach(day => {
          const wrapper = document.createElement('div');
          wrapper.className = 'day-wrapper';
          const dayChip = document.createElement('div');
          dayChip.className = 'chip';
          dayChip.textContent = day;
          // Time pill for this day (initially hidden)
          const timePill = document.createElement('div');
          timePill.className = 'time-pill';
          timePill.style.display = 'none';
          timePill.dataset.subj = subj;
          timePill.dataset.day = day;
          timePill.addEventListener('click', (e) => {
            // Prevent toggling day selection when clicking the time pill
            e.stopPropagation();
            const current = scheduleData[subj].times[day];
            let idx = timeOptions.indexOf(current);
            idx = (idx + 1) % timeOptions.length;
            scheduleData[subj].times[day] = timeOptions[idx];
            timePill.textContent = timeOptions[idx];
          });
          dayChip.addEventListener('click', () => {
            if (!dayChip.classList.contains('selected')) {
              dayChip.classList.add('selected');
              scheduleData[subj].days.push(day);
              // Assign a default time based on subject index. For weekend days start earlier.
              let defaultTime = defaultTimes[index % defaultTimes.length];
              if (day === '–°–±' || day === '–ù–¥') {
                defaultTime = '09:00';
              }
              scheduleData[subj].times[day] = defaultTime;
              timePill.textContent = defaultTime;
              timePill.style.display = 'inline-block';
            } else {
              dayChip.classList.remove('selected');
              scheduleData[subj].days = scheduleData[subj].days.filter(d => d !== day);
              delete scheduleData[subj].times[day];
              timePill.style.display = 'none';
            }
          });
          wrapper.appendChild(dayChip);
          wrapper.appendChild(timePill);
          dayGrid.appendChild(wrapper);
        });
        block.appendChild(dayGrid);
        container.appendChild(block);
      });
    }
    function goToLoading2() {
      for (const subj of selectedSubjects) {
        if (!scheduleData[subj] || scheduleData[subj].days.length === 0) {
          alert(`–û–±–µ—Ä—ñ—Ç—å –¥–Ω—ñ —Ç–∏–∂–Ω—è –¥–ª—è –ø—Ä–µ–¥–º–µ—Ç—É ${subj}`);
          return;
        }
      }
      // Check for overlapping schedules across subjects: if two or more subjects
      // are planned on the same day at the same time, prompt the user to adjust.
      const overlapMap = {};
      selectedSubjects.forEach(sub => {
        const times = scheduleData[sub] ? scheduleData[sub].times : {};
        Object.keys(times).forEach(day => {
          const key = day + '|' + times[day];
          if (!overlapMap[key]) overlapMap[key] = [];
          overlapMap[key].push(sub);
        });
      });
      const conflicts = [];
      Object.keys(overlapMap).forEach(key => {
        const subjectsAtTime = overlapMap[key];
        if (subjectsAtTime.length > 1) {
          const [day, time] = key.split('|');
          conflicts.push({ day, time, subjects: subjectsAtTime });
        }
      });
      if (conflicts.length > 0) {
        // Build a friendly message listing the conflicts for the user to correct.
        let msg = '–û–π, –∑–¥–∞—î—Ç—å—Å—è, –¥–µ—è–∫—ñ –ø—Ä–µ–¥–º–µ—Ç–∏ –∑–∞–ø–ª–∞–Ω–æ–≤–∞–Ω—ñ –æ–¥–Ω–æ—á–∞—Å–Ω–æ:\n';
        msg += conflicts.map(c => {
          const subjList = c.subjects.join(' —ñ ');
          return `${c.day} –æ ${c.time} ‚Äî ${subjList}`;
        }).join('\n');
        msg += '\n–ü—ñ–¥–∫–æ—Ä–∏–≥—É–π, –±—É–¥—å –ª–∞—Å–∫–∞, —á–∞—Å, —â–æ–± –∑–∞–Ω—è—Ç—Ç—è –Ω–µ –Ω–∞–∫–ª–∞–¥–∞–ª–∏—Å—å üòä';
        alert(msg);
        return;
      }
      gtag('event','onboarding_step_view',{step_key:'loading2',step_index:8});
      showStep(8);
      startLoading('progress-2', 12000, () => {
        showStep(9);
      });
    }
    function goToLoading3() {
      gtag('event','onboarding_step_view',{step_key:'loading3',step_index:10});
      showStep(10);
      startLoading('progress-3', 5000, () => {
        buildPreviewAndICS();
        showStep(11);
      });
    }
    function buildPreviewAndICS() {
      // Reset events array for manual .ics generation
      scheduleEvents = [];
      const weekPreview = document.getElementById('week-preview');
      weekPreview.innerHTML = '';
      const previewDays = { '–ü–Ω': new Set(), '–í—Ç': new Set(), '–°—Ä': new Set(), '–ß—Ç': new Set(), '–ü—Ç': new Set(), '–°–±': new Set(), '–ù–¥': new Set() };
      const examDate = examYear === '2026' ? new Date('2026-05-30') : new Date('2027-05-30');
      const now = new Date();
      const daysOfWeekMap = { '–ü–Ω':1, '–í—Ç':2, '–°—Ä':3, '–ß—Ç':4, '–ü—Ç':5, '–°–±':6, '–ù–¥':0 };
      selectedSubjects.forEach(subj => {
        let availableFrom = subjectAvailableFrom[subj] ? new Date(subjectAvailableFrom[subj]) : now;
        let startDate = new Date(Math.max(now.getTime(), availableFrom.getTime()));
        const totalHours = subjectHours[subj] || 0;
        const totalMinutes = totalHours * 60;
        let sessionDates = [];
        scheduleData[subj].days.forEach(day => {
          let dayIndex = daysOfWeekMap[day];
          let d = new Date(startDate);
          let diff = dayIndex - d.getDay();
          if (diff < 0) diff += 7;
          d.setDate(d.getDate() + diff);
          while (d <= examDate) {
            sessionDates.push(new Date(d));
            d = new Date(d);
            d.setDate(d.getDate() + 7);
          }
        });
        sessionDates.sort((a,b) => a - b);
        if (sessionDates.length === 0) return;
        let minutesPerSession = 0;
        if (sessionDates.length > 0) {
          minutesPerSession = totalMinutes / sessionDates.length;
          // Round to nearest 5 minutes
          minutesPerSession = Math.round(minutesPerSession / 5) * 5;
          if (minutesPerSession < 15) minutesPerSession = 15;
          if (minutesPerSession > 70) minutesPerSession = 70;
        }
        sessionDates.forEach(date => {
          const dowNames = ['–ù–¥','–ü–Ω','–í—Ç','–°—Ä','–ß—Ç','–ü—Ç','–°–±'];
          const dow = date.getDay();
          const dayName = dowNames[dow];
          let timeStr = scheduleData[subj].times[dayName];
          if (!timeStr) timeStr = '15:00';
          const [hh, mm] = timeStr.split(':');
          const start = new Date(date.getFullYear(), date.getMonth(), date.getDate(), parseInt(hh), parseInt(mm));
          const end = new Date(start.getTime() + minutesPerSession * 60 * 1000);
          // Push event details into array for manual .ics generation
          scheduleEvents.push({
            summary: `–î—Ä–∞–≥—ñ ‚Ä¢ ${subj}`,
            description: `–ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–æ ${subj}`,
            location: '',
            start: start,
            end: end,
            uid: `${subj}-${start.getTime()}`
          });
          if (previewDays[dayName]) previewDays[dayName].add(subj);
        });
      });
      const order = ['–ü–Ω','–í—Ç','–°—Ä','–ß—Ç','–ü—Ç','–°–±','–ù–¥'];
      order.forEach(day => {
        const cell = document.createElement('div');
        cell.className = 'day';
        const h4 = document.createElement('h4');
        h4.textContent = day;
        cell.appendChild(h4);
        const ul = document.createElement('ul');
        previewDays[day].forEach(subj => {
          const li = document.createElement('li');
          li.textContent = subj;
          ul.appendChild(li);
        });
        cell.appendChild(ul);
        weekPreview.appendChild(cell);
      });

      // After building the preview and scheduleEvents, refresh the app settings panel
      renderAppSettings();
    }
    function renderAppSettings() {
      const appDiv = document.getElementById('app-settings');
      if (!appDiv) return;
      appDiv.innerHTML = '';
      selectedSubjects.forEach(subj => {
        const setting = document.createElement('div');
        setting.className = 'subject-setting';
        const h4 = document.createElement('h4');
        h4.textContent = subj;
        setting.appendChild(h4);
        const ul = document.createElement('ul');
        if (scheduleData[subj] && scheduleData[subj].days) {
          /* Compute minutes per session for this subject. The number of sessions is
             determined by the selected days between now and the exam date. We then
             divide total required minutes evenly and round to the nearest 5.
          */
          const now = new Date();
          const examDate = examYear === '2026' ? new Date('2026-05-30') : new Date('2027-05-30');
          const daysOfWeekMap = { '–ü–Ω':1, '–í—Ç':2, '–°—Ä':3, '–ß—Ç':4, '–ü—Ç':5, '–°–±':6, '–ù–¥':0 };
          const availableFrom = subjectAvailableFrom[subj] ? new Date(subjectAvailableFrom[subj]) : now;
          const startDate = new Date(Math.max(now.getTime(), availableFrom.getTime()));
          const totalHours = subjectHours[subj] || 0;
          const totalMinutes = totalHours * 60;
          let sessionDates = [];
          scheduleData[subj].days.forEach(day => {
            const dayIndex = daysOfWeekMap[day];
            let d = new Date(startDate);
            let diff = dayIndex - d.getDay();
            if (diff < 0) diff += 7;
            d.setDate(d.getDate() + diff);
            while (d <= examDate) {
              sessionDates.push(new Date(d));
              d = new Date(d);
              d.setDate(d.getDate() + 7);
            }
          });
          sessionDates.sort((a,b) => a - b);
          let minutesPerSession = 0;
          if (sessionDates.length > 0) {
            minutesPerSession = totalMinutes / sessionDates.length;
            // Round to the nearest 5 minutes
            minutesPerSession = Math.round(minutesPerSession / 5) * 5;
            if (minutesPerSession < 15) minutesPerSession = 15;
            if (minutesPerSession > 70) minutesPerSession = 70;
          }
          // Build a single list item summarising all selected days and the recommended minutes
          const li = document.createElement('li');
          // Join days with comma
          const dayList = scheduleData[subj].days.join(', ');
          li.textContent = `${dayList}: ${minutesPerSession} —Ö–≤`;
          ul.appendChild(li);
        }
        setting.appendChild(ul);
        appDiv.appendChild(setting);
      });
    }
    function downloadSchedule() {
      // Track calendar download event in GA4
      gtag('event','calendar_download',{step_key:'calendar',step_index:11});
      // If no events, nothing to download
      if (!scheduleEvents || scheduleEvents.length === 0) return;

      // Build the .ics file contents as a string. Always generate text so we
      // can support downloads in limited webviews (e.g. Telegram).  
      const lines = [];
      lines.push('BEGIN:VCALENDAR');
      lines.push('VERSION:2.0');
      lines.push('PRODID:-//Dragi Onboarding//EN');
      scheduleEvents.forEach(ev => {
        lines.push('BEGIN:VEVENT');
        lines.push('UID:' + ev.uid);
        lines.push('SUMMARY:' + ev.summary);
        lines.push('DESCRIPTION:' + ev.description);
        if (ev.location) lines.push('LOCATION:' + ev.location);
        lines.push('DTSTAMP:' + formatDate(new Date()));
        lines.push('DTSTART:' + formatDate(ev.start));
        lines.push('DTEND:' + formatDate(ev.end));
        lines.push('BEGIN:VALARM');
        lines.push('TRIGGER:-PT5M');
        lines.push('ACTION:DISPLAY');
        lines.push('DESCRIPTION:Reminder');
        lines.push('END:VALARM');
        lines.push('END:VEVENT');
      });
      lines.push('END:VCALENDAR');
      const icsText = lines.join('\r\n');

      // Detect Telegram webview; if so, copy text to clipboard or display text area
      const ua = navigator.userAgent || '';
      const isTelegram = /Telegram/i.test(ua);
      if (isTelegram) {
        // Try to copy to clipboard
        if (navigator.clipboard && navigator.clipboard.writeText) {
          navigator.clipboard.writeText(icsText).then(() => {
            alert('–§–∞–π–ª —Ä–æ–∑–∫–ª–∞–¥—É —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ –≤ –±—É—Ñ–µ—Ä. –°–∫–æ–ø—ñ—é–π –π–æ–≥–æ –≤ —Ç–µ–∫—Å—Ç–æ–≤–∏–π —Ñ–∞–π–ª –∑ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è–º .ics —ñ –≤—ñ–¥–∫—Ä–∏–π —É —Å–≤–æ—î–º—É –∫–∞–ª–µ–Ω–¥–∞—Ä—ñ.');
          }).catch(() => {
            // Fall back to showing textarea with contents
            const container = document.getElementById('ics-copy-container');
            const ta = document.getElementById('ics-text');
            if (container && ta) {
              ta.value = icsText;
              container.style.display = 'block';
            }
          });
        } else {
          // Clipboard API unavailable; show textarea
          const container = document.getElementById('ics-copy-container');
          const ta = document.getElementById('ics-text');
          if (container && ta) {
            ta.value = icsText;
            container.style.display = 'block';
          }
        }
        return;
      }

      // Attempt blob download for modern browsers
      try {
        const blob = new Blob([icsText], { type: 'text/calendar;charset=utf-8' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'dragi-schedule.ics';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        setTimeout(() => URL.revokeObjectURL(url), 100);
        return;
      } catch (e) {
        // Fall through to data URL fallback
      }

      // Fallback for limited webviews. Use data URI and open/redirect
      const dataUrl = 'data:text/calendar;charset=utf-8,' + encodeURIComponent(icsText);
      const opened = window.open ? window.open(dataUrl, '_blank') : null;
      if (!opened) {
        window.location.href = dataUrl;
      }
    }

    // Allow the user to re-plan their schedule: rebuild the schedule form and return to the selection step
    function replanSchedule() {
      buildScheduleForm();
      showStep(7);
    }
    function goToStep12() {
      showStep(12);
    }
    function goToFinal() {
      showStep(13);
    }
    document.addEventListener('DOMContentLoaded', () => {
      attachSubjectSelection();
      const appleBtn = document.getElementById('apple-btn');
      const googleBtn = document.getElementById('google-btn');
      if (appleBtn) appleBtn.addEventListener('click', () => {
        // Log GA4 event when the user clicks the App¬†Store download button
        gtag('event','download_appstore',{event_category:'onboarding',event_label:'appstore_button',step_key:'final',step_index:13});
      });
      if (googleBtn) googleBtn.addEventListener('click', () => {
        // Log GA4 event when the user clicks the Google¬†Play download button
        gtag('event','download_googleplay',{event_category:'onboarding',event_label:'googleplay_button',step_key:'final',step_index:13});
      });
    });
    // Generate .ics file manually from events array
    function formatDate(date) {
      // Format to YYYYMMDDTHHMMSSZ using UTC
      const pad = (n) => String(n).padStart(2, '0');
      return (
        date.getUTCFullYear() +
        pad(date.getUTCMonth() + 1) +
        pad(date.getUTCDate()) + 'T' +
        pad(date.getUTCHours()) +
        pad(date.getUTCMinutes()) +
        pad(date.getUTCSeconds()) + 'Z'
      );
    }
    function generateICS(events, filename) {
      const lines = [];
      lines.push('BEGIN:VCALENDAR');
      lines.push('VERSION:2.0');
      lines.push('PRODID:-//Dragi Onboarding//EN');
      events.forEach(ev => {
        lines.push('BEGIN:VEVENT');
        lines.push('UID:' + ev.uid);
        lines.push('SUMMARY:' + ev.summary);
        lines.push('DESCRIPTION:' + ev.description);
        if (ev.location) lines.push('LOCATION:' + ev.location);
        lines.push('DTSTAMP:' + formatDate(new Date()));
        lines.push('DTSTART:' + formatDate(ev.start));
        lines.push('DTEND:' + formatDate(ev.end));
        // Alarm 5 minutes before event
        lines.push('BEGIN:VALARM');
        lines.push('TRIGGER:-PT5M');
        lines.push('ACTION:DISPLAY');
        lines.push('DESCRIPTION:Reminder');
        lines.push('END:VALARM');
        lines.push('END:VEVENT');
      });
      lines.push('END:VCALENDAR');
      const blob = new Blob([lines.join('\r\n')], { type: 'text/calendar' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename + '.ics';
      document.body.appendChild(a);
      a.click();
      setTimeout(() => {
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }, 0);
    }
  </script>
</body>
</html>